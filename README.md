# <img src="https://cloud.githubusercontent.com/assets/7833470/10899314/63829980-8188-11e5-8cdd-4ded5bcb6e36.png" height="60"> MEAN Auth Seed - Protected Blog Posts

**Objective:** Your goal is to add a blog `posts` resource to the following application using *protected* client-side and server-side routes.
    * Only a logged in user should be able to hit API endpoints for creating, updating, and destroying blog posts (on the server).
    * Only a logged in user should be able to see the forms and buttons for creating, updating, and destroying blog posts (on the client).

Please familiarize yourself with Satellizer and the file `middleware/auth.js` before beginning.

> <a href="https://github.com/sahat/satellizer#authloginuser-options" target="_blank">Satellizer Docs</a>

## App Setup

1. Clone this repo.

1. From inside the project directoy, run `npm install` to install the required `node_modules`.

1. In one Terminal window, run `mongod`, and in another, run `nodemon`.

1. Navigate to `localhost:9000` in the browser. You should see an empty page and an angry red error message in the Chrome console.

  > You should see `Error: ENOENT, no such file or directory '.env'` in your terminal

1. To fix it, add a ["dot env"](https://github.com/SF-WDI-LABS/mean-auth-seed) file, called **`.env`**, to the root directory. Add this line to the file:

  ```
  TOKEN_SECRET=yoursupersecrettoken
  ```

  This is the secret your server will use to encode the JWT token for each user. Note that this file is listed in `.gitignore` because you never want to expose your secret tokens on github.

1. Before hooking up the front-end, test your server routes via Postman:
  * Send a `GET` request to `/api/me`. You should see the message: "Please make sure your request has an Authorization header."
  * Send a `POST` request to `/auth/signup` with a test `email` and `password`. You should see a token that was generated by the server. (You are simulating a form submission, so make sure to use `x-www-form-urlencoded` and send your data in the `body` of the request).
  * Send a `POST` request to `/auth/login` with the `email` and `password` you just used to create a new user. You should again see a token that was generated by the server.

## Adding Posts

1. Create a form on the homepage for the user to add a blog-post (that's right - you're turning your Angular app into a microblog). The blog-post form should have input (`title`) and textarea (`content`) fields. Hint: Use `ng-model`.

1. Only show the form if there is a `currentUser` logged in.

1. Use the `ng-submit` directive to run a function called `createPost` when the user submits the form.

1. `createPost` should make an `$http.post` request to `/api/posts` (which isn't defined on the server yet!) with the `vm.post` object.

1. The next step is to implement posts on the server. First, create a Mongoose model `Post` (`models/post.js`).

1. A user should have many posts, so add an attribute to the `User` model called `posts` that references the `Post` model:

  ```js
  /*
   * models/user.js
   */

   var userSchema = new Schema({
     ...
     posts: [{ type: Schema.Types.ObjectId, ref: 'Post' }]
   });
  ```

8. In `server.js`, define two new API routes:
  * `GET /api/posts` should retrieve all the posts from the database.
  * `POST /api/posts` should create a new post that *belongs to* the current user (**Hint:** Use the `auth.ensureAuthenticated` function in the route to find the current user).

9. Refresh `localhost:3000` in the browser. Make sure you have a user logged in, and try to create a new post. Check the Chrome developer tools to make sure it's working.

## Finishing Touches

1. Validate blog-posts! Ensure a user can't submit an empty title or content. (Use both backend AND frontend validations).

2. On the user's profile page, display the number of posts the user has written. **Hint:** You'll need to add `.populate('posts')` to your `GET /api/me` route in `server.js`.

3. On the user profile page, the "Joined" date isn't formatted very nicely. Use Angular's built-in <a href="https://docs.angularjs.org/api/ng/filter/date" target="_blank">date filter</a> to display the date in this format: `January 25, 2016`.
